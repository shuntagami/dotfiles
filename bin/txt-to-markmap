#!/usr/bin/env ruby

input_file_path = ARGV[0]

if input_file_path.nil? || input_file_path.empty?
  puts "使用方法: txt-to-markmap <入力ファイル>"
  exit 1
end

# ファイルのベース名を取得して.mdを拡張子として設定
base_name = File.basename(input_file_path, ".*")
output_file_path = "#{base_name}.md"

# 入力ファイルを読み込み
content = File.readlines(input_file_path, chomp: true)

# 出力ファイル用のバッファ
output_content = []

# 最初の行を処理
if content.length > 0
  first_line = content[0].strip
  output_content << "# #{first_line}"
end

# 2行目以降を処理
content[1..].each do |line|
  # 行頭のタブを数える
  indent_level = line.count("\t")
  # タブを削除して行の内容を取得
  clean_line = line.strip
  # 箇条書きの行を作成 (レベルに応じてスペースと - を追加)
  output_content << "#{' ' * indent_level * 2}- #{clean_line}"
end

# カレントディレクトリに.mdファイルを保存
File.write(output_file_path, output_content.join("\n") + "\n")

puts "変換が完了しました。ファイル '#{output_file_path}' が作成されました。"
