#!/usr/bin/env node

const fs = require('fs');
const path = require('path');
const { execSync } = require('child_process');

const inputFile = process.argv[2];
if (!inputFile) {
  console.log('使用方法: txt-to-markmap <入力ファイル>');
  process.exit(1);
}

const baseName = path.basename(inputFile, path.extname(inputFile));
const outputFile = `${baseName}.md`;

const lines = fs.readFileSync(inputFile, 'utf8').split('\n');
const output = [];

if (lines.length > 0) {
  output.push(`# ${lines[0].trim()}`);
}

for (let i = 1; i < lines.length; i++) {
  const line = lines[i];
  const indentLevel = (line.match(/^\t*/)[0] || '').length;
  const clean = line.trim();
  if (clean) output.push(`${' '.repeat(indentLevel * 2)}- ${clean}`);
}

const content = output.join('\n') + '\n';
fs.writeFileSync(outputFile, content);

try {
  execSync('pbcopy', { input: content });
} catch {}

console.log(`変換が完了しました。ファイル '${outputFile}' が作成されました。（クリップボードにコピー済み）`);
